<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>SuperMario Scores</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      body { font-family: system-ui, Arial, sans-serif; margin: 2rem; }
      form, .board { max-width: 520px; }
      input, button { padding: .6rem; font-size: 1rem; }
      .row { display: flex; gap: .5rem; margin: .5rem 0; }
      table { border-collapse: collapse; margin-top: 1rem; width: 520px; }
      th, td { border-bottom: 1px solid #ddd; padding: .5rem; text-align: left; }
      th { background: #f8f8f8; }
    </style>
  </head>
  <body>
    <h1>SuperMario â€“ Submit Score</h1>
    <form id="scoreForm">
      <div class="row">
        <input id="name" placeholder="Gamer name" required />
        <input id="result" type="number" placeholder="Result" required />
        <button type="submit">Save</button>
      </div>
      <div id="msg"></div>
    </form>

    <div class="board">
      <h2>Leaderboard (Top 20)</h2>
      <table id="lb">
        <thead><tr><th>#</th><th>Gamer</th><th>Best</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <script>
      async function loadLeaderboard() {
        const res = await fetch('/api/leaderboard');
        const data = await res.json();
        const tb = document.querySelector('#lb tbody');
        tb.innerHTML = '';
        data.forEach((r, i) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${i+1}</td><td>${r.user_name}</td><td>${r.best}</td>`;
          tb.appendChild(tr);
        });
      }
      document.getElementById('scoreForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const user_name = document.getElementById('name').value.trim();
        const result = parseInt(document.getElementById('result').value, 10);
        const msg = document.getElementById('msg');
        msg.textContent = 'Saving...';
        const res = await fetch('/api/score', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ user_name, result })
        });
        if (res.ok) {
          msg.textContent = 'Saved!';
          await loadLeaderboard();
        } else {
          const j = await res.json().catch(() => ({}));
          msg.textContent = 'Error: ' + (j.error || res.statusText);
        }
      });
      loadLeaderboard();
    </script>
  </body>
</html>
