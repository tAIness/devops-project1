global:
  argoNamespace: argocd          # where Application CRs live
  repoURL: https://github.com/tAIness/devops-project1.git
  rootPath: ""                   # repo root unless you’re nesting
project:
  enabled: true
  name: default

apps:
  - name: backend
    path: infra/helm/backend
    destinationNamespace: mario-backend
    # (optional) helm values for the backend chart:
    values:
      ingress:
        enabled: true
        host: api.mario.local
        useRegex: false

      db:
        enabled: true
        storage:
          size: 1Gi
          storageClass: local-path   # you can omit if default class is local-path
        service:
          name: db
          port: 5432

  - name: web
    path: infra/helm/web
    destinationNamespace: mario-web
    # values:  # can omit because chart has defaults now
    #   ingress:
    #     enabled: true
    #     host: web.mario.local

    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi

  - name: monitoring
    destinationNamespace: monitoring
    helmChart: kube-prometheus-stack
    repoURL: https://prometheus-community.github.io/helm-charts
    targetRevision: 62.3.0
    helm:
      values: |
        # Minikube-friendly (don’t try to scrape control-plane)
        kubeEtcd: { enabled: false }
        kubeControllerManager: { enabled: false }
        kubeScheduler: { enabled: false }
        defaultRules:
          rules:
            etcd: false
            kubeControllerManager: false
            kubeScheduler: false

      grafana:
        adminUser: admin
        adminPassword: admin
        ingress:
          enabled: true
          ingressClassName: nginx
          hosts: [grafana.mario.local]

      prometheus:
        ingress:
          enabled: true
          ingressClassName: nginx
          hosts: [prometheus.mario.local]
        prometheusSpec:
          # discover ServiceMonitors/PodMonitors cluster-wide
          serviceMonitorSelectorNilUsesHelmValues: false
          podMonitorSelectorNilUsesHelmValues: false
          serviceMonitorNamespaceSelector: {}
          podMonitorNamespaceSelector: {}

      alertmanager:
        ingress:
          enabled: true
          ingressClassName: nginx
          hosts: [alertmanager.mario.local]
