# infra/helm/argocd-apps/values.yaml

global:
  argoNamespace: argocd
  repoURL: https://github.com/tAIness/devops-project1.git
  rootPath: ""
  # optional: set a fixed git ref for in-repo apps; defaults to HEAD in template
  # targetRevision: v1.0.79

project:
  enabled: true
  name: default

apps:
  - name: backend
    path: infra/helm/backend
    destinationNamespace: mario-backend
    values:
      ingress:
        enabled: true
        host: api.mario.local
        useRegex: false
      db:
        enabled: true
        storage:
          size: 1Gi
          storageClass: local-path
        service:
          name: db
          port: 5432

  - name: web
    path: infra/helm/web
    destinationNamespace: mario-web
    values:
      ingress:
        enabled: true
        host: web.mario.local

helmApps:
  - name: monitoring
    destinationNamespace: monitoring
    source:
      repoURL: https://prometheus-community.github.io/helm-charts
      chart: kube-prometheus-stack
      targetRevision: 62.3.0
    helm:
      skipCrds: false
      values: |
        # Disable control-plane bits not present on minikube
        kubeEtcd: { enabled: false }
        kubeControllerManager: { enabled: false }
        kubeScheduler: { enabled: false }
        defaultRules:
          rules:
            etcd: false
            kubeControllerManager: false
            kubeScheduler: false

        grafana:
          admin:
            existingSecret: grafana-admin
            userKey: admin-user
            passwordKey: admin-password
          ingress:
            enabled: true
            ingressClassName: nginx
            hosts:
              - grafana.mario.local
          service:
            type: ClusterIP

        prometheus:
          ingress:
            enabled: true
            ingressClassName: nginx
            hosts:
              - prometheus.mario.local
          prometheusSpec:
            serviceMonitorSelectorNilUsesHelmValues: false
            podMonitorSelectorNilUsesHelmValues: false
            serviceMonitorNamespaceSelector: {}
            podMonitorNamespaceSelector: {}

        alertmanager:
          enabled: true
          ingress:
            enabled: true
            ingressClassName: nginx
            hosts:
              - alertmanager.mario.local
          alertmanagerSpec:
            storage:
              volumeClaimTemplate:
                spec:
                  storageClassName: local-path
                  accessModes:
                    - ReadWriteOnce
                  resources:
                    requests:
                      storage: 1Gi

# This relies on your templates/secrets.yaml to render a Secret from here
secrets:
  - namespace: monitoring
    name: grafana-admin
    stringData:
      admin-user: admin
      admin-password: admin
